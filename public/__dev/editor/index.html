<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¨¡å—ç¼–è¾‘å™¨ - Scratch Modules Gallery</title>
    <link rel="stylesheet" href="/__dev/editor/editor.css" />
    <style>
      .script-preview .scratchblocks {
        margin: 10px 0;
      }
    </style>
    <!-- Import map for CodeMirror -->
    <script type="importmap">
      {
        "imports": {
          "@codemirror/state": "/node_modules/@codemirror/state/dist/index.js",
          "@codemirror/view": "/node_modules/@codemirror/view/dist/index.js",
          "@codemirror/commands": "/node_modules/@codemirror/commands/dist/index.js",
          "@codemirror/language": "/node_modules/@codemirror/language/dist/index.js",
          "@codemirror/search": "/node_modules/@codemirror/search/dist/index.js",
          "@codemirror/autocomplete": "/node_modules/@codemirror/autocomplete/dist/index.js",
          "@codemirror/lint": "/node_modules/@codemirror/lint/dist/index.js",
          "@codemirror/lang-javascript": "/node_modules/@codemirror/lang-javascript/dist/index.js",
          "@lezer/highlight": "/node_modules/@lezer/highlight/dist/index.js",
          "@lezer/common": "/node_modules/@lezer/common/dist/index.js",
          "@lezer/lr": "/node_modules/@lezer/lr/dist/index.js",
          "style-mod": "/node_modules/style-mod/src/style-mod.js",
          "w3c-keyname": "/node_modules/w3c-keyname/index.js",
          "crelt": "/node_modules/crelt/index.js",
          "@marijn/find-cluster-break": "/node_modules/@marijn/find-cluster-break/src/index.js"
        }
      }
    </script>
  </head>
  <body>
    <div id="app">
      <!-- ä¾§è¾¹æ  -->
      <aside id="sidebar">
        <div class="sidebar-header">
          <div class="header-top">
            <h1>æ¨¡å—ç¼–è¾‘å™¨</h1>
            <button id="sidebar-toggle" class="btn-icon" title="åˆ‡æ¢ä¾§è¾¹æ ">
              <!-- å›¾æ ‡ menu -->
              <svg
                viewBox="0 0 24 24"
                width="24"
                height="24"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M4 5h16" />
                <path d="M4 12h16" />
                <path d="M4 19h16" />
              </svg>
            </button>
          </div>
          <a href="/" target="_blank" class="btn-link">æŸ¥çœ‹ç½‘ç«™</a>
        </div>

        <div class="search-box">
          <input type="search" id="module-search" placeholder="æœç´¢æ¨¡å—..." />
        </div>

        <ul id="module-list" class="module-list">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </ul>

        <div class="sidebar-footer">
          <button id="create-module-btn" class="btn btn-primary">+ æ–°å»ºæ¨¡å—</button>
        </div>
      </aside>

      <!-- ä¸»ç¼–è¾‘åŒº -->
      <main id="editor-main">
        <div id="editor-empty" class="empty-state">
          <p>ğŸ‘ˆ é€‰æ‹©ä¸€ä¸ªæ¨¡å—å¼€å§‹ç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°æ¨¡å—</p>
        </div>

        <div id="editor-content" style="display: none">
          <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
          <nav id="tabs" class="tabs">
            <button data-tab="meta" class="tab-btn active">å…ƒä¿¡æ¯</button>
            <button data-tab="scripts" class="tab-btn">è„šæœ¬</button>
            <button data-tab="i18n" class="tab-btn">ç¿»è¯‘</button>
            <button data-tab="assets" class="tab-btn">èµ„æº</button>
            <button id="view-module-btn" class="btn" style="margin-left: auto; background: none">
              æŸ¥çœ‹æ¨¡å—é¡µ
            </button>
          </nav>

          <!-- æ ‡ç­¾é¡µå†…å®¹ -->
          <div id="tab-content" class="tab-content">
            <!-- Meta æ ‡ç­¾é¡µ -->
            <div id="tab-meta" class="tab-panel active">
              <form id="meta-form">
                <div class="form-group">
                  <label for="meta-id">æ¨¡å— ID *</label>
                  <input type="text" id="meta-id" readonly class="form-control" />
                  <small>æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåˆ›å»ºåä¸å¯ä¿®æ”¹</small>
                </div>

                <div class="form-group">
                  <label for="meta-name">åç§° *</label>
                  <input
                    type="text"
                    id="meta-name"
                    required
                    class="form-control"
                    placeholder="ä¾‹å¦‚ï¼šFPS"
                  />
                </div>

                <div class="form-group">
                  <label for="meta-description">æè¿° *</label>
                  <textarea
                    id="meta-description"
                    required
                    class="form-control"
                    rows="3"
                    placeholder="ç®€çŸ­æè¿°è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½"
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="meta-tags">æ ‡ç­¾</label>
                  <input
                    type="text"
                    id="meta-tags"
                    class="form-control"
                    placeholder="ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šperformance, utility"
                  />
                  <small>ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾</small>
                </div>

                <div class="form-group">
                  <label for="meta-keywords">å…³é”®è¯</label>
                  <input
                    type="text"
                    id="meta-keywords"
                    class="form-control"
                    placeholder="ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šframe rate, rendering, performance"
                  />
                  <small>SEO å…³é”®è¯ï¼Œç”¨äºæœç´¢å’Œå…ƒæ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”</small>
                </div>

                <div class="form-group">
                  <label for="meta-contributors">è´¡çŒ®è€…</label>
                  <input
                    type="text"
                    id="meta-contributors"
                    class="form-control"
                    placeholder="ä¾‹å¦‚ï¼šgh/username, sc/username, åå­—"
                  />
                  <small>æ ¼å¼ï¼šgh/GitHubç”¨æˆ·å, sc/Scratchç”¨æˆ·å, æˆ–ç›´æ¥è¾“å…¥åå­—</small>
                </div>

                <div class="form-actions">
                  <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                  <button type="button" id="delete-module-btn" class="btn btn-danger">
                    åˆ é™¤æ¨¡å—
                  </button>
                </div>
              </form>
            </div>

            <!-- Scripts æ ‡ç­¾é¡µ -->
            <div
              id="tab-scripts"
              class="tab-panel"
              style="display: none; padding: 0; overflow: hidden"
            >
              <div class="scripts-container">
                <div class="scripts-sidebar" id="scripts-sidebar">
                  <div class="scripts-sidebar-header">
                    <button
                      id="add-script-btn"
                      class="btn btn-primary btn-icon-text"
                      title="æ·»åŠ è„šæœ¬"
                    >
                      <span class="icon">+</span> <span class="text">æ·»åŠ è„šæœ¬</span>
                    </button>
                    <button id="toggle-scripts-sidebar" class="btn-icon" title="æŠ˜å /å±•å¼€">
                      <!-- å›¾æ ‡ menu -->
                      <svg
                        viewBox="0 0 24 24"
                        width="18"
                        height="18"
                        stroke="currentColor"
                        stroke-width="2"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M4 5h16" />
                        <path d="M4 12h16" />
                        <path d="M4 19h16" />
                      </svg>
                    </button>
                  </div>
                  <div class="scripts-list">
                    <ul id="script-files-list">
                      <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                  </div>
                </div>

                <div class="script-editor">
                  <div id="script-editor-empty" class="empty-state">
                    <p>é€‰æ‹©ä¸€ä¸ªè„šæœ¬æ–‡ä»¶å¼€å§‹ç¼–è¾‘</p>
                  </div>

                  <div id="script-editor-content" style="display: none">
                    <div class="script-editor-header">
                      <div style="display: flex; gap: 10px; flex: 1">
                        <input
                          type="number"
                          id="script-order"
                          class="form-control"
                          placeholder="é¡ºåº"
                          min="1"
                          style="width: 100px"
                        />
                        <input
                          type="text"
                          id="script-filename"
                          class="form-control"
                          placeholder="è„šæœ¬ ID"
                          style="flex: 1"
                        />
                      </div>
                      <div class="script-actions">
                        <select
                          id="preview-style-select"
                          class="form-control"
                          title="é¢„è§ˆé£æ ¼"
                          style="width: auto; padding: 4px 8px; font-size: 12px"
                        >
                          <option value="scratch3">Scratch 3</option>
                          <option value="scratch3-high-contrast">S3 é«˜å¯¹æ¯”</option>
                          <option value="scratch2">Scratch 2</option>
                        </select>
                        <button
                          id="toggle-layout-btn"
                          class="btn btn-sm btn-secondary"
                          title="åˆ‡æ¢å¸ƒå±€"
                        >
                          <!-- å›¾æ ‡ rows-2 -->
                          <svg
                            viewBox="0 0 24 24"
                            width="16"
                            height="16"
                            stroke="currentColor"
                            stroke-width="2"
                            fill="none"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          >
                            <rect width="18" height="18" x="3" y="3" rx="2" />
                            <path d="M3 12h18" />
                          </svg>
                        </button>
                        <button id="save-script-btn" class="btn btn-sm btn-primary">ä¿å­˜</button>
                        <button id="delete-script-btn" class="btn btn-sm btn-danger">åˆ é™¤</button>
                      </div>
                    </div>

                    <div id="script-editor-body" class="layout-horizontal">
                      <div id="script-content-wrapper" class="script-editor-wrapper"></div>
                      <div id="editor-splitter" class="splitter"></div>
                      <div id="script-preview-pane" class="script-preview">
                        <div id="script-preview-content"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- i18n æ ‡ç­¾é¡µ -->
            <div id="tab-i18n" class="tab-panel" style="display: none">
              <div class="i18n-toolbar">
                <select id="i18n-locale-select" class="form-control">
                  <option value="">é€‰æ‹©è¯­è¨€...</option>
                  <option value="en">English (en)</option>
                  <option value="zh-cn">ç®€ä½“ä¸­æ–‡ (zh-cn)</option>
                  <option value="zh-tw">ç¹é«”ä¸­æ–‡ (zh-tw)</option>
                </select>
                <button id="save-i18n-btn" class="btn btn-primary" disabled>ä¿å­˜ç¿»è¯‘</button>
                <button id="delete-i18n-btn" class="btn btn-danger" disabled>åˆ é™¤ç¿»è¯‘</button>
              </div>

              <div id="i18n-editor-empty" class="empty-state">
                <p>é€‰æ‹©ä¸€ä¸ªè¯­è¨€å¼€å§‹ç¼–è¾‘ç¿»è¯‘</p>
              </div>

              <form id="i18n-form" style="display: none">
                <div class="form-group">
                  <label for="i18n-name">åç§°</label>
                  <input type="text" id="i18n-name" class="form-control" />
                </div>

                <div class="form-group">
                  <label for="i18n-description">æè¿°</label>
                  <textarea id="i18n-description" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group">
                  <label for="i18n-tags">æ ‡ç­¾</label>
                  <input type="text" id="i18n-tags" class="form-control" placeholder="ç”¨é€—å·åˆ†éš”" />
                </div>

                <div class="form-group">
                  <label for="i18n-keywords">å…³é”®è¯</label>
                  <input
                    type="text"
                    id="i18n-keywords"
                    class="form-control"
                    placeholder="ç”¨é€—å·åˆ†éš”"
                  />
                </div>

                <div class="form-group">
                  <label>å…¶ä»–ç¿»è¯‘å­—æ®µï¼ˆJSON æ ¼å¼ï¼‰</label>
                  <textarea
                    id="i18n-extra"
                    class="form-control"
                    rows="10"
                    placeholder='{"variables": {"varName": "å˜é‡å"}, "lists": {}, "events": {}}'
                  ></textarea>
                  <small
                    >æ”¯æŒ variables, lists, events, scriptTitles, procedures, procedureParams
                    ç­‰å­—æ®µ</small
                  >
                </div>
              </form>
            </div>

            <!-- Assets æ ‡ç­¾é¡µ -->
            <div id="tab-assets" class="tab-panel" style="display: none">
              <div class="assets-section">
                <h3>Demo é¡¹ç›® (.sb3)</h3>
                <div id="demo-upload-area" class="upload-area">
                  <input type="file" id="demo-file-input" accept=".sb3" style="display: none" />
                  <button id="upload-demo-btn" class="btn btn-primary">ä¸Šä¼  Demo</button>
                  <div id="demo-status"></div>
                </div>
              </div>

              <div class="assets-section">
                <h3>èµ„æºæ–‡ä»¶</h3>
                <div id="assets-upload-area" class="upload-area">
                  <input
                    type="file"
                    id="asset-file-input"
                    accept=".png,.jpg,.jpeg,.gif,.svg,.pdf"
                    style="display: none"
                  />
                  <button id="upload-asset-btn" class="btn btn-primary">ä¸Šä¼ èµ„æº</button>
                </div>

                <ul id="assets-list" class="assets-list">
                  <!-- åŠ¨æ€ç”Ÿæˆ -->
                </ul>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- æ„å»ºçŠ¶æ€æŒ‡ç¤ºå™¨ -->
      <div id="build-status" class="build-status">
        <span id="build-status-text">å°±ç»ª</span>
      </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šåˆ›å»ºæ¨¡å— -->
    <div id="create-module-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>åˆ›å»ºæ–°æ¨¡å—</h2>
          <button class="modal-close modal-close-icon">&times;</button>
        </div>
        <form id="create-module-form">
          <div class="form-group">
            <label for="create-id">æ¨¡å— ID *</label>
            <input
              type="text"
              id="create-id"
              required
              class="form-control"
              pattern="[a-z0-9-]+"
              placeholder="ä¾‹å¦‚ï¼šmy-module"
            />
            <small>åªå…è®¸å°å†™å­—æ¯ã€æ•°å­—å’ŒçŸ­æ¨ªçº¿</small>
          </div>

          <div class="form-group">
            <label for="create-name">åç§° *</label>
            <input
              type="text"
              id="create-name"
              required
              class="form-control"
              placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„æ¨¡å—"
            />
          </div>

          <div class="form-group">
            <label for="create-description">æè¿° *</label>
            <textarea id="create-description" required class="form-control" rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="create-tags">æ ‡ç­¾</label>
            <input type="text" id="create-tags" class="form-control" placeholder="ç”¨é€—å·åˆ†éš”" />
          </div>

          <div class="modal-actions">
            <button type="submit" class="btn btn-primary">åˆ›å»º</button>
            <button type="button" class="btn btn-secondary modal-close">å–æ¶ˆ</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="/__dev/editor/editor.js"></script>
  </body>
</html>
